{"version":3,"sources":["file:///C:/Users/ffgdgrrr/Desktop/rpg/assets/tools/cameraFollow/CameraFollow.ts"],"names":["_decorator","Component","Node","UITransform","tween","Vec3","Enum","ccclass","property","xy","CameraFollow","type","followPos","isShake","followPosY","onLoad","blackBoard","width","Canvas","node","getPosition","x","height","start","onLoadShake","shake","update","deltaTime","FollowNode","position","followPosType","Xposition","XYposition","setPosition","y","z","Yposition","scheduleOnce","by","CameraShake","duration","strength","sequence","repeat"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,W,OAAAA,W;AAAmBC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AAAsCC,MAAAA,I,OAAAA,I;;;;;;;;;OAChG;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;AACzBS,MAAAA,E,0BAAAA,E;AAAAA,QAAAA,E,CAAAA,E;AAAAA,QAAAA,E,CAAAA,E;AAAAA,QAAAA,E,CAAAA,E;eAAAA,E;QAAAA,E;;AAKLH,MAAAA,IAAI,CAACG,EAAD,CAAJ;;8BAEaC,Y,WADZH,OAAO,CAAC,cAAD,C,UAEHC,QAAQ,CAAC;AAACG,QAAAA,IAAI,EAACF;AAAN,OAAD,C,UAIRD,QAAQ,CAACL,WAAD,C,UAGRK,QAAQ,CAACL,WAAD,C,UAGRK,QAAQ,CAACN,IAAD,C,2BAZb,MACaQ,YADb,SACkCT,SADlC,CAC4C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAOxC;AAPwC;;AAUxC;AAVwC;;AAAA,eAaxCW,SAbwC;AAAA,eAcxCC,OAdwC,GAcvB,KAduB;AAAA,eAexCC,UAfwC;AAAA;;AAgBxCC,QAAAA,MAAM,GAAE;AACJ,eAAKH,SAAL,GAAe,CAAC,KAAKI,UAAL,CAAgBC,KAAjB,GAAuB,CAAvB,GAAyB,KAAKC,MAAL,CAAYD,KAAZ,GAAkB,CAA3C,GAA6C,KAAKD,UAAL,CAAgBG,IAAhB,CAAqBC,WAArB,GAAmCC,CAA/F;AACA,eAAKP,UAAL,GAAgB,CAAC,KAAKE,UAAL,CAAgBM,MAAjB,GAAwB,CAAxB,GAA0B,KAAKJ,MAAL,CAAYI,MAAZ,GAAmB,CAA7D;AACH;;AACDC,QAAAA,KAAK,GAAG;AACJ,cAAG,KAAKC,WAAL,IAAkB,IAArB,EAA0B;AACtB,iBAAKC,KAAL;AACH;AACJ;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACtB;AACA,cAAG,KAAKd,OAAL,IAAc,KAAd,IAAqB,KAAKG,UAAL,IAAiB,IAAtC,IAA6C,KAAKY,UAArD,EAAgE;AAC5D,gBAAG,KAAKA,UAAL,CAAgBC,QAAhB,CAAyBR,CAAzB,GAA2B,KAAKT,SAAhC,IAA2C,KAAKgB,UAAL,CAAgBC,QAAhB,CAAyBR,CAAzB,GAA4B,CAAC,KAAKT,SAAhF,EAA2F;AACvF,kBAAG,KAAKkB,aAAL,IAAoBrB,EAAE,CAACsB,SAAvB,IAAkC,KAAKD,aAAL,IAAoBrB,EAAE,CAACuB,UAA5D,EAAuE;AACnE,qBAAKb,IAAL,CAAUc,WAAV,CAAsB,KAAKL,UAAL,CAAgBC,QAAhB,CAAyBR,CAA/C,EAAiD,KAAKF,IAAL,CAAUU,QAAV,CAAmBK,CAApE,EAAsE,KAAKf,IAAL,CAAUU,QAAV,CAAmBM,CAAzF;AACH;AAEJ;;AACD,gBAAG,KAAKP,UAAL,CAAgBC,QAAhB,CAAyBK,CAAzB,GAA2B,KAAKpB,UAAhC,IAA4C,KAAKc,UAAL,CAAgBC,QAAhB,CAAyBK,CAAzB,GAA4B,CAAC,KAAKpB,UAAjF,EAA6F;AACzF,kBAAG,KAAKgB,aAAL,IAAoBrB,EAAE,CAAC2B,SAAvB,IAAkC,KAAKN,aAAL,IAAoBrB,EAAE,CAACuB,UAA5D,EAAuE;AACvE,qBAAKb,IAAL,CAAUc,WAAV,CAAsB,KAAKd,IAAL,CAAUU,QAAV,CAAmBR,CAAzC,EAA2C,KAAKO,UAAL,CAAgBC,QAAhB,CAAyBK,CAApE,EAAsE,KAAKf,IAAL,CAAUU,QAAV,CAAmBM,CAAzF;AACH;AACJ;AACA,WAZD,MAYK;AAAC,iBAAKhB,IAAL,CAAUc,WAAV,CAAsB,KAAKL,UAAL,CAAgBC,QAAhB,CAAyBR,CAA/C,EAAiD,KAAKO,UAAL,CAAgBC,QAAhB,CAAyBK,CAA1E,EAA4E,KAAKf,IAAL,CAAUU,QAAV,CAAmBM,CAA/F;AAEL;AAEJ;;AACDV,QAAAA,KAAK,GAAE;AACH,eAAKZ,OAAL,GAAa,IAAb;AACA,eAAKwB,YAAL,CAAkB,MAAI;AAClB,iBAAKxB,OAAL,GAAa,KAAb;AACH,WAFD,EAEE,GAFF;AAGAT,UAAAA,KAAK,CAAC,KAAKe,IAAN,CAAL,CACCmB,EADD,CACI,IADJ,EACS;AAACT,YAAAA,QAAQ,EAAC,IAAIxB,IAAJ,CAAS,CAAC,CAAV,EAAY,CAAZ;AAAV,WADT,EAECiC,EAFD,CAEI,IAFJ,EAES;AAACT,YAAAA,QAAQ,EAAC,IAAIxB,IAAJ,CAAS,CAAT,EAAW,CAAC,CAAZ;AAAV,WAFT,EAGCkB,KAHD;AAIH;;AACDgB,QAAAA,WAAW,CAACC,QAAD,EAAmBC,QAAnB,EAAqC;AAC5C;AACA,cAAMC,QAAQ,GAAGtC,KAAK,CAAC,KAAKe,IAAN,CAAL,CACZmB,EADY,CACT,IADS,EACH;AAAET,YAAAA,QAAQ,EAAE,IAAIxB,IAAJ,CAASoC,QAAT,EAAmB,CAAnB,EAAsB,CAAtB;AAAZ,WADG,EAEZH,EAFY,CAET,IAFS,EAEH;AAAET,YAAAA,QAAQ,EAAE,IAAIxB,IAAJ,CAAS,CAACoC,QAAV,EAAoB,CAApB,EAAuB,CAAvB;AAAZ,WAFG,EAGZH,EAHY,CAGT,IAHS,EAGH;AAAET,YAAAA,QAAQ,EAAE,IAAIxB,IAAJ,CAAS,CAAT,EAAYoC,QAAZ,EAAsB,CAAtB;AAAZ,WAHG,EAIZH,EAJY,CAIT,IAJS,EAIH;AAAET,YAAAA,QAAQ,EAAE,IAAIxB,IAAJ,CAAS,CAAT,EAAY,CAACoC,QAAb,EAAuB,CAAvB;AAAZ,WAJG,CAAjB;AAKIC,UAAAA,QAAQ,CAACnB,KAAT,GACCoB,MADD,CACQH,QADR,EACiBE,QADjB;AAGP;;AAjEuC,O;;;;;iBAEvBjC,EAAE,CAACuB,U;;sFACnBxB,Q;;;;;iBACmB,K;;;;;;;iBAED,I;;;;;;;iBAGI,I;;;;;;;iBAGP,I","sourcesContent":["import { _decorator, Component, Node, UITransform, find, tween, Vec3, EventMouse, quat, v2, v3, Vec2, Enum } from 'cc';\nconst { ccclass, property } = _decorator;\nenum xy{\n    Xposition,\n    Yposition,\n    XYposition,\n}\nEnum(xy)\n@ccclass('CameraFollow')\nexport class CameraFollow extends Component {\n    @property({type:xy})\n    followPosType:xy=xy.XYposition\n    @property\n    onLoadShake:boolean=false\n    @property(UITransform)\n    Canvas:UITransform=null!\n    //跟随到这个节点的x轴边界为止，要求是此节点的x轴为0\n    @property(UITransform)\n    blackBoard:UITransform=null!\n    //摄像机要跟随的节点\n    @property(Node)\n    FollowNode:Node=null!\n    followPos:number;\n    isShake: boolean=false\n    followPosY: number;\n    onLoad(){\n        this.followPos=-this.blackBoard.width/2+this.Canvas.width/2+this.blackBoard.node.getPosition().x\n        this.followPosY=-this.blackBoard.height/2+this.Canvas.height/2\n    }\n    start() {\n        if(this.onLoadShake==true){\n            this.shake()\n        }\n    }\n\n    update(deltaTime: number) {\n        //console.log([this.followPos,this.FollowNode.position.x])\n        if(this.isShake==false&&this.blackBoard!=null!&&this.FollowNode){\n            if(this.FollowNode.position.x>this.followPos&&this.FollowNode.position.x<(-this.followPos)){\n                if(this.followPosType==xy.Xposition||this.followPosType==xy.XYposition){\n                    this.node.setPosition(this.FollowNode.position.x,this.node.position.y,this.node.position.z)\n                }\n            \n            }\n            if(this.FollowNode.position.y>this.followPosY&&this.FollowNode.position.y<(-this.followPosY)){\n                if(this.followPosType==xy.Yposition||this.followPosType==xy.XYposition){\n                this.node.setPosition(this.node.position.x,this.FollowNode.position.y,this.node.position.z)\n            }\n        }\n        }else{this.node.setPosition(this.FollowNode.position.x,this.FollowNode.position.y,this.node.position.z)\n\n        }\n        \n    }\n    shake(){\n        this.isShake=true\n        this.scheduleOnce(()=>{\n            this.isShake=false\n        },0.1)\n        tween(this.node)\n        .by(0.05,{position:new Vec3(-5,5)})\n        .by(0.05,{position:new Vec3(5,-5)})\n        .start()\n    }\n    CameraShake(duration: number, strength: number) {\n        // 相机抖动的动画效果\n        const sequence = tween(this.node)\n            .by(0.05, { position: new Vec3(strength, 0, 0) })\n            .by(0.05, { position: new Vec3(-strength, 0, 0) })\n            .by(0.05, { position: new Vec3(0, strength, 0) })\n            .by(0.05, { position: new Vec3(0, -strength, 0) })\n            sequence.start()\n            .repeat(duration,sequence);\n\n    }\n}\n\n"]}