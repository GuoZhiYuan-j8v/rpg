{"version":3,"sources":["file:///C:/Users/ffgdgrrr/Desktop/rpg/assets/tools/dialog/typeScript/dialog_galgame.ts"],"names":["_decorator","Component","TextAsset","Label","Button","Prefab","Layout","instantiate","EventHandler","sys","tween","Input","input","Sprite","SpriteFrame","view","AudioClip","AudioSource","color","ProgressBar","dialogLocalData","highPriorityGlobalInput","ccclass","property","action","dialog_galgame","tooltip","displayName","type","dialogindex","dialogRows","cell","index","jumptext","canPress","anima","canRestart","isChoose","start","once","getSysLocalAboutDialogDOM","node","name","active","setSysLocalAboutDIalog","add","readText","csv","showDialogRow","becomeBlack","children","getComponent","by","onLoad","on","EventType","TOUCH_START","click","KEY_DOWN","onKeyDown","KEY_PRESSING","localStorage","removeItem","console","log","onClickNext","unscheduleAllCallbacks","text","string","getItem","event","keyCode","parseInt","length","onDestroy","off","update","deltaTime","showTextAnim","setItem","i","scheduleOnce","setAni","动画重复检测","play","updateText","_name","_text","eventHandler","emit","stop","clip","Name","renwu_spriteFrame","renwu_sprite","spriteFrame","NoPictureNoDisplay","bgSpriteFrame","bg_sprite","resizeBackground","screenSize","getVisibleSize","textureSize","originalSize","screenRatio","width","height","imageRatio","targetScale","setScale","setPosition","_TextAsset","split","DialogueFunc","endFunc","GenerateOption","onOptionClick","id","getComponentsInChildren","destroyAllChildren","DialogueChooseFunc","cell5","setTimeout","Restart","_index","button","optionButton","setParent","cell1","dd","condition","time","elseSkip","ooc","TimeProgress","to","Number","progress","call","destroy","condition2","replace","CLICK","getComponentInChildren","trim","interactable"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, TextAsset, Label, Button, Prefab, Layout, resources, instantiate, EventHandler, sys, SkelAnimDataHub, Camera, find, UITransform, tween, animation, Animation, director, EventKeyboard, KeyCode, Input, input, Sprite, SpriteFrame, BaseRenderData, view } from 'cc';\r\nimport { dialogLocalData } from '../../本地存储/dialogLocal';\r\nimport { AudioClip } from 'cc';\r\nimport { AudioSource } from 'cc';\r\nimport { color } from 'cc';\r\nimport { ProgressBar } from 'cc';\r\nimport { highPriorityGlobalInput } from '../../HighInput/HighPriorityGlobalInput';\r\nconst { ccclass, property } = _decorator;\r\nexport enum action {\r\n    add,\r\n    delete,\r\n}\r\n@ccclass('dialog_galgame')\r\nexport class dialog_galgame extends Component {\r\n    @property(AudioSource)\r\n    AudioSource: AudioSource = null!\r\n    @property(AudioClip)\r\n    AudioClip: AudioClip[] = []\r\n    @property\r\n    once: boolean = false\r\n    @property([EventHandler])\r\n    eventHandler: EventHandler[] = []\r\n    @property({ tooltip: '没有放人物立绘的位置不显示图片' })\r\n    NoPictureNoDisplay: boolean = false\r\n    @property({ displayName: \"人物立绘资源\", tooltip: \"图片数组代表在dialogindex的位置，比如0就在dialogindex等于0的时候显示图片\", type: SpriteFrame })\r\n    renwu_spriteFrame: SpriteFrame[] = []\r\n    @property({ displayName: \"背景图片资源\", tooltip: \"图片数组代表在dialogindex的位置，比如0就在dialogindex等于0的时候显示图片\", type: SpriteFrame })\r\n    bgSpriteFrame: SpriteFrame[] = []\r\n    @property({ displayName: \"切换背景图片组件\", tooltip: \"切换图片节点\", type: Sprite })\r\n    bg_sprite: Sprite = null!\r\n    @property({ displayName: \"切换人物立绘图片组件\", tooltip: \"切换图片节点\", type: Sprite })\r\n    renwu_sprite: Sprite = null!\r\n    @property({ displayName: \"csv对话文本文件\", tooltip: \"对话内容\", type: TextAsset })\r\n    csv: TextAsset = null!\r\n    @property({ displayName: \"对话\", tooltip: \"对话内容的label\", type: Label })\r\n    text: Label = null!\r\n    @property({ displayName: \"名字\", tooltip: \"名字的label\", type: Label })\r\n    Name: Label = null!\r\n    @property(Prefab)\r\n    optionButton: Prefab = null!\r\n    @property(Layout)\r\n    Layout: Layout = null!\r\n    //跳转对话的id\r\n    dialogindex: number = 0\r\n    dialogRows: string[] = []\r\n    cell: string[];\r\n    index: number;\r\n    jumptext: string = null;\r\n    canPress: boolean = true\r\n    anima: string;\r\n    @property(Prefab)\r\n    TimeProgress: Prefab = null!\r\n    @property\r\n    endDelete: boolean = false\r\n    canRestart: boolean;\r\n    isChoose: boolean = false\r\n    start() {\r\n        if (this.once == true) {\r\n            if (dialogLocalData.getSysLocalAboutDialogDOM(this.node.name)) {\r\n                this.node.active = false\r\n            }\r\n            dialogLocalData.setSysLocalAboutDIalog(this.node.name, action.add)\r\n        }\r\n        //dialogLocalData.getSysLocalAboutDialog()\r\n        this.readText(this.csv)\r\n        this.showDialogRow()\r\n    }\r\n    becomeBlack() {\r\n        tween(this.node.children[0].getComponent(Sprite))\r\n            .by(0.1, { color: color(0, 0, 0, 30) })\r\n            .start()\r\n    }\r\n    onLoad() {\r\n        highPriorityGlobalInput.on(Input.EventType.TOUCH_START, this.click, this)\r\n        input.on(Input.EventType.KEY_DOWN, this.onKeyDown, this)\r\n        input.on(Input.EventType.KEY_PRESSING, this.onKeyDown, this)\r\n        sys.localStorage.removeItem('JUMPTEXT')\r\n    }\r\n    click() {\r\n        console.log('press')\r\n        if (this.isChoose == false) {\r\n            if (this.canPress == true && this.node.active == true) {\r\n                this.onClickNext()\r\n                /*if(this.node.name=='序'){\r\n                    find('Canvas/Label').active=false\r\n                }*/\r\n            } else if (this.canPress == false) {\r\n                this.unscheduleAllCallbacks()\r\n                this.text.string = sys.localStorage.getItem('text')\r\n                this.canPress = true\r\n            }\r\n        }\r\n    }\r\n    onKeyDown(event: EventKeyboard) {\r\n        switch (event.keyCode) {\r\n            case parseInt(sys.localStorage.getItem('next')):\r\n                if (this.dialogRows.length > 0) {\r\n                    this.click()\r\n                }\r\n\r\n                break;\r\n        }\r\n    }\r\n    protected onDestroy(): void {\r\n        highPriorityGlobalInput.off(Input.EventType.TOUCH_START, this.click, this)\r\n        input.off(Input.EventType.KEY_DOWN, this.onKeyDown, this)\r\n        input.off(Input.EventType.KEY_PRESSING, this.onKeyDown, this)\r\n    }\r\n    update(deltaTime: number) {\r\n        //this.node.setPosition(find('Canvas/Camera').position)\r\n    }\r\n    showTextAnim(text: string) {\r\n        sys.localStorage.setItem('text', text)\r\n        for (let i = 0; i < text.length; i++) {\r\n            this.scheduleOnce(() => {\r\n                this.text.string += text[i]\r\n                if (this.text.string == text) {\r\n                    this.canPress = true\r\n                    console.log('canpress')\r\n                }\r\n            }, 0.1 * i)\r\n        }\r\n\r\n    }\r\n    setAni(anima: string, node: Animation, 动画重复检测: boolean) {\r\n        if (动画重复检测 == true) {\r\n            if (this.anima == anima) { return }\r\n        }\r\n        this.anima = anima\r\n        node.play(anima)\r\n    }\r\n    updateText(_name: string, _text: string) {\r\n        if (this.eventHandler[this.dialogindex]) {\r\n            this.eventHandler[this.dialogindex].emit([])\r\n        }\r\n        if (this.AudioClip[this.dialogindex]) {\r\n            this.AudioSource.stop()\r\n            this.AudioSource.clip = this.AudioClip[this.dialogindex]\r\n            this.AudioSource.play()\r\n        }\r\n        this.Name.string = _name;\r\n        this.canPress = false\r\n        this.text.string = \"\";\r\n        if (this.renwu_spriteFrame[this.dialogindex] != null) {\r\n            this.renwu_sprite.spriteFrame = this.renwu_spriteFrame[this.dialogindex];\r\n        } else if (this.NoPictureNoDisplay == true) {\r\n            this.renwu_sprite.spriteFrame = null\r\n        }\r\n        if (this.bgSpriteFrame[this.dialogindex] != null) {\r\n            this.bg_sprite.spriteFrame = this.bgSpriteFrame[this.dialogindex];\r\n            this.resizeBackground()\r\n        }\r\n        // 逐字显示文本\r\n        this.showTextAnim(_text)\r\n    }\r\n    // 在设置完 spriteFrame 后调用这个函数\r\n    private resizeBackground() {\r\n        // 获取屏幕可见区域尺寸\r\n        const screenSize = view.getVisibleSize();\r\n\r\n        // 获取图片原始尺寸\r\n        const spriteFrame = this.bg_sprite.spriteFrame;\r\n        const textureSize = spriteFrame?.originalSize;\r\n        if (!textureSize) return;\r\n\r\n        // 计算屏幕与图片的宽高比\r\n        const screenRatio = screenSize.width / screenSize.height;\r\n        const imageRatio = textureSize.width / textureSize.height;\r\n\r\n        // 计算适配比例\r\n        let targetScale = 1;\r\n        if (screenRatio > imageRatio) {\r\n            // 以高度为基准缩放\r\n            targetScale = screenSize.height / textureSize.height;\r\n        } else {\r\n            // 以宽度为基准缩放\r\n            targetScale = screenSize.width / textureSize.width;\r\n        }\r\n\r\n        // 应用缩放\r\n        this.bg_sprite.node.setScale(targetScale, targetScale);\r\n\r\n        // 确保居中显示（如果锚点不是0.5需要调整）\r\n        this.bg_sprite.node.setPosition(0, 0);\r\n    }\r\n    readText(_TextAsset: TextAsset) {\r\n        this.dialogRows = _TextAsset.text.split('\\n')\r\n    }\r\n    showDialogRow() {\r\n\r\n        for (let index = 0; index < this.dialogRows.length; index++) {\r\n            this.cell = this.dialogRows[index].split(',')\r\n            if (this.cell[0] == '#' && parseInt(this.cell[1]) == this.dialogindex) {\r\n                this.canPress = true\r\n                this.updateText(this.cell[2], this.cell[3])\r\n                this.dialogindex = parseInt(this.cell[4])\r\n                this.DialogueFunc(this.cell[5])\r\n                console.log(this.cell[4])\r\n\r\n                if (this.cell[4] == '') {\r\n                    if (this.eventHandler[this.dialogindex]) {\r\n                        this.eventHandler[this.dialogindex].emit([])\r\n                    }\r\n                    console.log('endFunc')\r\n                    this.endFunc()\r\n                }\r\n                break\r\n            } else if (this.cell[0] == '&' && parseInt(this.cell[1]) == this.dialogindex) {\r\n                this.canPress = false\r\n                this.GenerateOption(index)\r\n            }\r\n        }\r\n    }\r\n    onOptionClick(id: number) {\r\n\r\n        this.dialogindex = id\r\n        this.showDialogRow()\r\n        for (let index = 0; index < this.Layout.getComponentsInChildren(Button).length; index++) {\r\n            this.Layout.node.destroyAllChildren()\r\n        }\r\n    }\r\n    //对话选项绑定函数\r\n    DialogueChooseFunc(cell5) {\r\n\r\n\r\n    }\r\n    endFunc() {\r\n        setTimeout(() => {\r\n            this.node.active=false\r\n        });\r\n        \r\n    }\r\n    Restart() {\r\n        this.readText(this.csv)\r\n        this.dialogindex = 0\r\n        this.cell = this.dialogRows[1].split(',')\r\n        if (this.canRestart == true) {\r\n            this.showDialogRow()\r\n            this.canRestart = false\r\n        }\r\n\r\n    }\r\n    DialogueFunc(cell5) {\r\n\r\n    }\r\n\r\n    GenerateOption(_index: number) {\r\n        while (true) {\r\n            this.cell = this.dialogRows[_index].split(',');\r\n            if (this.cell[0] == '&') {\r\n                let button = instantiate(this.optionButton);\r\n                button.setParent(this.Layout.node);\r\n                let cell1 = this.cell[1]\r\n                let dd = this.cell[4];\r\n                let cell = this.cell[5];\r\n                let condition = this.cell[6];\r\n                let time = this.cell[7]\r\n                let elseSkip = this.cell[8]\r\n                this.isChoose = true\r\n                let ooc = () => {\r\n                    this.unscheduleAllCallbacks()\r\n                    this.isChoose = false\r\n                    this.DialogueChooseFunc(cell);\r\n                    this.onOptionClick(parseInt(dd));\r\n                    if (this.eventHandler[cell1]) {\r\n                        this.eventHandler[cell1].emit([])\r\n                    }\r\n\r\n\r\n                };\r\n                if (time) {\r\n                    let TimeProgress = instantiate(this.TimeProgress)\r\n                    TimeProgress.setParent(this.node)\r\n                    tween(TimeProgress.getComponent(ProgressBar))\r\n                        .to(Number(time), { progress: 0 })\r\n                        .call(() => {\r\n                            TimeProgress.destroy()\r\n                        })\r\n                        .start()\r\n                    this.scheduleOnce(() => {\r\n                        const condition2 = elseSkip.replace(/[^a-zA-Z0-9 :]/g, '')\r\n                        this.dialogindex = Number(condition2)\r\n\r\n                        for (let index = 0; index < this.Layout.getComponentsInChildren(Button).length; index++) {\r\n                            this.Layout.node.destroyAllChildren()\r\n                        }\r\n                        this.showDialogRow()\r\n                        this.isChoose = false\r\n                    }, Number(time))\r\n                }\r\n                button.on(Button.EventType.CLICK, ooc, this);\r\n                button.getComponentInChildren(Label).string = this.cell[3];\r\n                //语法：“名字”:“值”\r\n                console.log(typeof condition)\r\n                if (condition) {\r\n                    if (condition.trim()) {\r\n                     \r\n                        // let celll = condition2.split(':')\r\n                        // console.log(celll, condition2)\r\n                        // console.log(sys.localStorage.getItem(celll[0]), celll[1])\r\n                        if (dialogLocalData.getSysLocalAboutDialogDOM(condition)) {\r\n                            button.getComponent(Button).interactable = true\r\n                        } else {\r\n                            button.getComponent(Button).interactable = false\r\n                        }\r\n                    }\r\n                }\r\n\r\n                _index++;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    onClickNext() {\r\n        /*this.button_next.node.active=true\r\n        this.cell=this.dialogRows[parseInt(this.jumptext)].split(',')\r\n        this.dialogindex=parseInt(this.cell[4])*/\r\n        this.showDialogRow()\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n"]}