{"version":3,"sources":["file:///C:/Users/ffgdgrrr/Desktop/rpg/assets/tools/%E6%97%B6%E9%97%B4/time.ts"],"names":["director","sys","Director","find","instantiate","Prefab","Label","_decorator","Component","ccclass","property","time","type","timeElapsed","gameTimePerDay","timeLabelNode","days","start","addPersistRootNode","node","schedule","updateTime","updateTimeLabel","minutes","Math","floor","seconds","getComponent","string","padZero","currentScene","timeLabel","setParent","setPosition","onLoad","timeData","JSON","parse","localStorage","getItem","on","EVENT_AFTER_SCENE_LAUNCH","onDestroy","setItem","stringify","off","num","toString"],"mappings":"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","sourcesContent":["import { director, sys } from 'cc';\r\nimport { Director } from 'cc';\r\nimport { find } from 'cc';\r\nimport { instantiate } from 'cc';\r\nimport { Prefab } from 'cc';\r\nimport { Label } from 'cc';\r\nimport { _decorator, Component, Node } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('time')\r\nexport class time extends Component {\r\n    @property({ type:Prefab })\r\n    timeLabel: Prefab = null; // 用于显示时间的 Label 组件\r\n\r\n    private timeElapsed: number = 0; // 已经过的游戏时间\r\n    private gameTimePerDay: number = 15 * 60; // 游戏中一天的时间（秒）\r\n    timeLabelNode: Node;\r\n    days:number=0\r\n    start() {\r\n        director.addPersistRootNode(this.node)\r\n        this.schedule(this.updateTime, 1); // 每秒更新游戏时间\r\n    }\r\n\r\n    updateTime() {\r\n        this.timeElapsed += 1; // 模拟游戏时间流逝\r\n        if (this.timeElapsed >= this.gameTimePerDay) {\r\n            this.timeElapsed = 0; // 一天结束，重置时间\r\n            this.days++\r\n        }\r\n        this.updateTimeLabel(); // 更新显示时间的 Label\r\n    }\r\n\r\n    updateTimeLabel() {\r\n        const minutes = Math.floor(this.timeElapsed / 60);\r\n        const seconds = this.timeElapsed % 60;\r\n        this.timeLabelNode.getComponent(Label).string = '第'+this.days+'天'+`${this.padZero(minutes)}:${this.padZero(seconds)}`; // 格式化时间为 MM:SS 的形式\r\n    }\r\n    currentScene(){\r\n        this.timeLabelNode=instantiate(this.timeLabel)\r\n        this.timeLabelNode.setParent(find('Canvas/Camera'))\r\n        this.timeLabelNode.setPosition(-600,0,0)\r\n    }\r\n    protected onLoad(): void {\r\n        let timeData:number[]= JSON.parse(sys.localStorage.getItem(\"time\"))\r\n        if(timeData){\r\n            this.days=timeData[0]\r\n            this.timeElapsed=timeData[1]\r\n        }\r\n        \r\n        director.on(Director.EVENT_AFTER_SCENE_LAUNCH,this.currentScene,this)\r\n    }\r\n    protected onDestroy(): void {\r\n        sys.localStorage.setItem(\"time\",JSON.stringify([this.days,this.timeElapsed]))\r\n        director.off(Director.EVENT_AFTER_SCENE_LAUNCH,this.currentScene,this)\r\n    }\r\n    padZero(num: number): string {\r\n        return num < 10 ? '0' + num : num.toString(); // 补零函数，确保时间格式为两位数\r\n    }\r\n}\r\n\r\n\r\n"]}